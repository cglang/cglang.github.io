<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>安装 WSL 并升级为 WSL2 | Stray Stone</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/lily/assets/css/0.styles.a8478412.css" as="style"><link rel="preload" href="/lily/assets/js/app.b52c596d.js" as="script"><link rel="preload" href="/lily/assets/js/2.d557c063.js" as="script"><link rel="preload" href="/lily/assets/js/17.2602a876.js" as="script"><link rel="prefetch" href="/lily/assets/js/10.548a7d4c.js"><link rel="prefetch" href="/lily/assets/js/11.97bbb2d5.js"><link rel="prefetch" href="/lily/assets/js/12.faae83e0.js"><link rel="prefetch" href="/lily/assets/js/13.ebacc1be.js"><link rel="prefetch" href="/lily/assets/js/14.c8ffce22.js"><link rel="prefetch" href="/lily/assets/js/15.d783735a.js"><link rel="prefetch" href="/lily/assets/js/16.1f00ac5b.js"><link rel="prefetch" href="/lily/assets/js/18.91e0ab1a.js"><link rel="prefetch" href="/lily/assets/js/19.29d5db68.js"><link rel="prefetch" href="/lily/assets/js/3.be73de15.js"><link rel="prefetch" href="/lily/assets/js/4.e05c873c.js"><link rel="prefetch" href="/lily/assets/js/5.f3e6ed41.js"><link rel="prefetch" href="/lily/assets/js/6.498ab014.js"><link rel="prefetch" href="/lily/assets/js/7.82569640.js"><link rel="prefetch" href="/lily/assets/js/8.f1e9ba36.js"><link rel="prefetch" href="/lily/assets/js/9.afefcec2.js">
    <link rel="stylesheet" href="/lily/assets/css/0.styles.a8478412.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lily/" class="home-link router-link-active"><!----> <span class="site-name">Stray Stone</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lily/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/lily/net/" class="nav-link">
  .Net
</a></div><div class="nav-item"><a href="/lily/linux/" class="nav-link router-link-active">
  Linux
</a></div><div class="nav-item"><a href="/lily/docker/" class="nav-link">
  Docker
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lily/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/lily/net/" class="nav-link">
  .Net
</a></div><div class="nav-item"><a href="/lily/linux/" class="nav-link router-link-active">
  Linux
</a></div><div class="nav-item"><a href="/lily/docker/" class="nav-link">
  Docker
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/lily/linux/" class="sidebar-heading clickable router-link-active open"><span>Linux基础</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/lily/linux/basic/00-info.html" class="sidebar-link">Linux 简介</a></li><li><a href="/lily/linux/basic/01-start.html" class="sidebar-link">开始</a></li><li><a href="/lily/linux/basic/install-wsl.html" aria-current="page" class="active sidebar-link">安装 WSL 并升级为 WSL2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lily/linux/basic/install-wsl.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/lily/linux/basic/install-wsl.html#开机启动-wsl" class="sidebar-link">开机启动 WSL</a></li><li class="sidebar-sub-header"><a href="/lily/linux/basic/install-wsl.html#设置-linux-系统自启动服务" class="sidebar-link">设置 Linux 系统自启动服务</a></li><li class="sidebar-sub-header"><a href="/lily/linux/basic/install-wsl.html#宿主机连接-wsl-主机问题" class="sidebar-link">宿主机连接 WSL 主机问题</a></li><li class="sidebar-sub-header"><a href="/lily/linux/basic/install-wsl.html#wsl-中获取宿主机-ip-及自己的-ip" class="sidebar-link">WSL 中获取宿主机 IP 及自己的 IP</a></li><li class="sidebar-sub-header"><a href="/lily/linux/basic/install-wsl.html#wsl-虚拟机的导出与导入" class="sidebar-link">WSL 虚拟机的导出与导入</a></li></ul></li><li><a href="/lily/linux/basic/02-file-content.html" class="sidebar-link">文件和目录管理</a></li><li><a href="/lily/linux/basic/03-remote.html" class="sidebar-link">使用 SSH 远程连接登录 Linux</a></li></ul></section></li><li><a href="/lily/linux/jnjx/" class="sidebar-link">Linux进阶</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="安装-wsl-并升级为-wsl2"><a href="#安装-wsl-并升级为-wsl2" class="header-anchor">#</a> 安装 WSL 并升级为 WSL2</h1> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>WSL 是 Windows Subsystem for Linux 的简称，他是一个基于 Windwos 子系统的 Linux，用于提供快速运行 Linux 命令和工具。WSL 目前有 WSL 和 WSL 2 两个版本，其中 WSL 2 功能更强大，并支持 Docker 的运行，这是我使用它的一个原因之一。<a href="https://docs.microsoft.com/zh-cn/windows/wsl/" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p><a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-win10" target="_blank" rel="noopener noreferrer">WSL 官方安装文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="_1-启用适用于-linux-的-windows-子系统功能"><a href="#_1-启用适用于-linux-的-windows-子系统功能" class="header-anchor">#</a> 1. 启用适用于 Linux 的 Windows 子系统功能</h3> <p>在 <code>控制面板</code> - <code>程序和功能</code> - <code>启用或关闭 Windows 功能</code> - <code>适用于 Linux 的 Windows 子系统</code> ，勾选即可。</p> <h3 id="_2-在应用商店安装自己喜欢的-linux-发行版"><a href="#_2-在应用商店安装自己喜欢的-linux-发行版" class="header-anchor">#</a> 2. 在应用商店安装自己喜欢的 Linux 发行版</h3> <p>打开 <code>应用商店</code> - <code>搜索 'linux'</code> - <code>安装自己喜欢的发行版</code></p> <h3 id="_3-使用-linux"><a href="#_3-使用-linux" class="header-anchor">#</a> 3. 使用 Linux</h3> <p><code>开始菜单</code> - <code>启动安装的 Linux 发行版</code></p> <p>一般情况下第一次启动需要新建用户(我是用的是Ubuntu)，按提示进行即可。</p> <h3 id="_4-升级为-wsl-2"><a href="#_4-升级为-wsl-2" class="header-anchor">#</a> 4. 升级为 WSL 2</h3> <p>默认情况下启用该功能会是 WSL 版本而不是 WSL 2 版本，要使用 WSL 2 需手动升级。</p> <p>在升级 WSL 2 之前需先<strong>启用虚拟机功能</strong>，因为 WSL 2 是在微软 Hyper-V 之上运行的。(以管理员身份在 PowerShell中执行下列命令)</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>dism<span class="token punctuation">.</span>exe <span class="token operator">/</span>online <span class="token operator">/</span><span class="token function">enable-feature</span> <span class="token operator">/</span>featurename:VirtualMachinePlatform <span class="token operator">/</span>all <span class="token operator">/</span>norestart
</code></pre></div><p><strong>将 WSL 2 设置为默认版本</strong></p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>wsl <span class="token operator">--</span><span class="token function">set-default</span><span class="token operator">-</span>version 2
</code></pre></div><p><strong>重新启动</strong> 计算机，以完成 WSL 2 更新。</p> <h2 id="开机启动-wsl"><a href="#开机启动-wsl" class="header-anchor">#</a> 开机启动 WSL</h2> <p>因为我会经常使用到 WSL 以及其中运行的服务，而且我不喜欢在每次启动电脑时手动的去启动 WSL 所以我做了以下操作。</p> <h3 id="打开-windows-启动文件夹目录"><a href="#打开-windows-启动文件夹目录" class="header-anchor">#</a> 打开 Windows 启动文件夹目录</h3> <p>按下 <code>Win + R</code> 输入 <code>shell:startup</code> ，新建一个 vbs 脚本文件，写入</p> <div class="language-vbscript extra-class"><pre class="language-text"><code>Set ws = WScript.CreateObject(&quot;WScript.Shell&quot;)
ws.run &quot;wsl -d Ubuntu-20.04&quot;
</code></pre></div><p>我这里使用的是 <code>Ubuntu-20.04</code> ，你只需要换成自己的版本即可，使用 <code>wsl --list</code> 命令查看所有的 Linux 分发版本。这样在你启动计算机的时候指定的WSl Linux分发版就自动启动了</p> <blockquote><p>之所以使用 vbs 而不是批处理文件是因为我不想看见批处理文件的那个丑陋的黑框框。</p></blockquote> <blockquote><p>注：WSL 在我的机器上大约会一直占用 1G 左右的内存，有时还会到 2G 左右，所以他是比较占内存的。</p></blockquote> <h2 id="设置-linux-系统自启动服务"><a href="#设置-linux-系统自启动服务" class="header-anchor">#</a> 设置 Linux 系统自启动服务</h2> <p>WSL 的 Linux 是有很多坑的，就比方说他不会自动启动大不部分的服务，也不可使用 <code>systemctl</code> 命令。下面是我使用的解决方法。</p> <p><strong>在WSL发行版中创建文件：/etc/init.wsl</strong>，并设置其拥有可执行权限，比如我要开机启用 <code>supervisor</code> 服务，我只需如下操作。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/init.wsl

<span class="token comment">#!/bin/sh</span>
<span class="token function">service</span> supervisor start
<span class="token comment"># 保存退出</span>

<span class="token function">sudo</span> <span class="token function">chmod</span> +x /etc/init.wsl
</code></pre></div><p>然后我们编辑我们 Windwos 主机中自启动脚本，添加 <code>-u root /etc/init.wsl</code> 参数。</p> <div class="language-vbscript extra-class"><pre class="language-text"><code>Set ws = WScript.CreateObject(&quot;WScript.Shell&quot;)        
ws.run &quot;wsl -d Ubuntu-20.04 -u root /etc/init.wsl&quot;
</code></pre></div><blockquote><p>参考文章 <a href="https://zhuanlan.zhihu.com/p/47733615" target="_blank" rel="noopener noreferrer">WSL 服务自动启动的正确方法 - 知乎 (zhihu.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="宿主机连接-wsl-主机问题"><a href="#宿主机连接-wsl-主机问题" class="header-anchor">#</a> 宿主机连接 WSL 主机问题</h2> <p>有时候我们在 WSL 中运行了一些服务，比如 MySQL 之类的我们需要使用它就要获取他的 IP ，但 WSL 每次启动的时候都会有不同的 IP 地址，所以每次重启计算机都要重新获取 WSL 的 IP 是一件很麻烦的事情，当然网上的解决方案有很多，就比如有使用脚本侥幸处理的，我使用的是名为 <code>go-wsl2-host</code> 的开源软件，GitHub 地址为 <a href="https://github.com/shayne/go-wsl2-host" target="_blank" rel="noopener noreferrer">go-wsl2-host<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，可自行参考安装即可。</p> <p><strong>我使用时遇到的问题</strong></p> <ol><li>这个软件的方案就是修改主机的 hosts 文件来达到目的，如果有遇到<strong>hosts</strong>文件没有修改成功的问题，请尝试将 hosts 文件的只读属性取消勾选。</li></ol> <h2 id="wsl-中获取宿主机-ip-及自己的-ip"><a href="#wsl-中获取宿主机-ip-及自己的-ip" class="header-anchor">#</a> WSL 中获取宿主机 IP 及自己的 IP</h2> <p>WSL 每次启动的时候都会有不同的 IP 地址，但他会把 IP 写在 <code>/etc/resolv.conf</code> 中。</p> <p><strong>获取宿主机 IP</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cat</span> /etc/resolv.conf <span class="token operator">|</span> <span class="token function">grep</span> nameserver <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{ print <span class="token variable">$2</span> }'</span>
</code></pre></div><p><strong>获取自己的 IP</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">hostname</span> -I <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$1</span>}'</span>
<span class="token comment"># 或者使用 ip 命令查看</span>
<span class="token function">ip</span> a
</code></pre></div><h2 id="wsl-虚拟机的导出与导入"><a href="#wsl-虚拟机的导出与导入" class="header-anchor">#</a> WSL 虚拟机的导出与导入</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>wsl --export <span class="token operator">&lt;</span>分发版名称<span class="token operator">&gt;</span> 导出文件.tar
wsl --import <span class="token operator">&lt;</span>分发版名称<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>安装位置<span class="token operator">&gt;</span> 导入文件.tar
<span class="token comment"># 移除</span>
wsl --unregister <span class="token operator">&lt;</span>分发版名称<span class="token operator">&gt;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lily/linux/basic/01-start.html" class="prev">
        开始
      </a></span> <span class="next"><a href="/lily/linux/basic/02-file-content.html">
        文件和目录管理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/lily/assets/js/app.b52c596d.js" defer></script><script src="/lily/assets/js/2.d557c063.js" defer></script><script src="/lily/assets/js/17.2602a876.js" defer></script>
  </body>
</html>
