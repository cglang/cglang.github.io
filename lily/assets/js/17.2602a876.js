(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{371:function(s,t,a){"use strict";a.r(t);var e=a(45),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"安装-wsl-并升级为-wsl2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-wsl-并升级为-wsl2"}},[s._v("#")]),s._v(" 安装 WSL 并升级为 WSL2")]),s._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),a("p",[s._v("WSL 是 Windows Subsystem for Linux 的简称，他是一个基于 Windwos 子系统的 Linux，用于提供快速运行 Linux 命令和工具。WSL 目前有 WSL 和 WSL 2 两个版本，其中 WSL 2 功能更强大，并支持 Docker 的运行，这是我使用它的一个原因之一。"),a("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/windows/wsl/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/windows/wsl/install-win10",target:"_blank",rel:"noopener noreferrer"}},[s._v("WSL 官方安装文档"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"_1-启用适用于-linux-的-windows-子系统功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-启用适用于-linux-的-windows-子系统功能"}},[s._v("#")]),s._v(" 1. 启用适用于 Linux 的 Windows 子系统功能")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("控制面板")]),s._v(" - "),a("code",[s._v("程序和功能")]),s._v(" - "),a("code",[s._v("启用或关闭 Windows 功能")]),s._v(" - "),a("code",[s._v("适用于 Linux 的 Windows 子系统")]),s._v(" ，勾选即可。")]),s._v(" "),a("h3",{attrs:{id:"_2-在应用商店安装自己喜欢的-linux-发行版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-在应用商店安装自己喜欢的-linux-发行版"}},[s._v("#")]),s._v(" 2. 在应用商店安装自己喜欢的 Linux 发行版")]),s._v(" "),a("p",[s._v("打开 "),a("code",[s._v("应用商店")]),s._v(" - "),a("code",[s._v("搜索 'linux'")]),s._v(" - "),a("code",[s._v("安装自己喜欢的发行版")])]),s._v(" "),a("h3",{attrs:{id:"_3-使用-linux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用-linux"}},[s._v("#")]),s._v(" 3. 使用 Linux")]),s._v(" "),a("p",[a("code",[s._v("开始菜单")]),s._v(" - "),a("code",[s._v("启动安装的 Linux 发行版")])]),s._v(" "),a("p",[s._v("一般情况下第一次启动需要新建用户(我是用的是Ubuntu)，按提示进行即可。")]),s._v(" "),a("h3",{attrs:{id:"_4-升级为-wsl-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-升级为-wsl-2"}},[s._v("#")]),s._v(" 4. 升级为 WSL 2")]),s._v(" "),a("p",[s._v("默认情况下启用该功能会是 WSL 版本而不是 WSL 2 版本，要使用 WSL 2 需手动升级。")]),s._v(" "),a("p",[s._v("在升级 WSL 2 之前需先"),a("strong",[s._v("启用虚拟机功能")]),s._v("，因为 WSL 2 是在微软 Hyper-V 之上运行的。(以管理员身份在 PowerShell中执行下列命令)")]),s._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[s._v("dism"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("online "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("enable-feature")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("featurename:VirtualMachinePlatform "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("all "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("norestart\n")])])]),a("p",[a("strong",[s._v("将 WSL 2 设置为默认版本")])]),s._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[s._v("wsl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set-default")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("version 2\n")])])]),a("p",[a("strong",[s._v("重新启动")]),s._v(" 计算机，以完成 WSL 2 更新。")]),s._v(" "),a("h2",{attrs:{id:"开机启动-wsl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开机启动-wsl"}},[s._v("#")]),s._v(" 开机启动 WSL")]),s._v(" "),a("p",[s._v("因为我会经常使用到 WSL 以及其中运行的服务，而且我不喜欢在每次启动电脑时手动的去启动 WSL 所以我做了以下操作。")]),s._v(" "),a("h3",{attrs:{id:"打开-windows-启动文件夹目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打开-windows-启动文件夹目录"}},[s._v("#")]),s._v(" 打开 Windows 启动文件夹目录")]),s._v(" "),a("p",[s._v("按下 "),a("code",[s._v("Win + R")]),s._v(" 输入 "),a("code",[s._v("shell:startup")]),s._v(" ，新建一个 vbs 脚本文件，写入")]),s._v(" "),a("div",{staticClass:"language-vbscript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('Set ws = WScript.CreateObject("WScript.Shell")\nws.run "wsl -d Ubuntu-20.04"\n')])])]),a("p",[s._v("我这里使用的是 "),a("code",[s._v("Ubuntu-20.04")]),s._v(" ，你只需要换成自己的版本即可，使用 "),a("code",[s._v("wsl --list")]),s._v(" 命令查看所有的 Linux 分发版本。这样在你启动计算机的时候指定的WSl Linux分发版就自动启动了")]),s._v(" "),a("blockquote",[a("p",[s._v("之所以使用 vbs 而不是批处理文件是因为我不想看见批处理文件的那个丑陋的黑框框。")])]),s._v(" "),a("blockquote",[a("p",[s._v("注：WSL 在我的机器上大约会一直占用 1G 左右的内存，有时还会到 2G 左右，所以他是比较占内存的。")])]),s._v(" "),a("h2",{attrs:{id:"设置-linux-系统自启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置-linux-系统自启动服务"}},[s._v("#")]),s._v(" 设置 Linux 系统自启动服务")]),s._v(" "),a("p",[s._v("WSL 的 Linux 是有很多坑的，就比方说他不会自动启动大不部分的服务，也不可使用 "),a("code",[s._v("systemctl")]),s._v(" 命令。下面是我使用的解决方法。")]),s._v(" "),a("p",[a("strong",[s._v("在WSL发行版中创建文件：/etc/init.wsl")]),s._v("，并设置其拥有可执行权限，比如我要开机启用 "),a("code",[s._v("supervisor")]),s._v(" 服务，我只需如下操作。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/init.wsl\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" supervisor start\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存退出")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /etc/init.wsl\n")])])]),a("p",[s._v("然后我们编辑我们 Windwos 主机中自启动脚本，添加 "),a("code",[s._v("-u root /etc/init.wsl")]),s._v(" 参数。")]),s._v(" "),a("div",{staticClass:"language-vbscript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('Set ws = WScript.CreateObject("WScript.Shell")        \nws.run "wsl -d Ubuntu-20.04 -u root /etc/init.wsl"\n')])])]),a("blockquote",[a("p",[s._v("参考文章 "),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/47733615",target:"_blank",rel:"noopener noreferrer"}},[s._v("WSL 服务自动启动的正确方法 - 知乎 (zhihu.com)"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"宿主机连接-wsl-主机问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#宿主机连接-wsl-主机问题"}},[s._v("#")]),s._v(" 宿主机连接 WSL 主机问题")]),s._v(" "),a("p",[s._v("有时候我们在 WSL 中运行了一些服务，比如 MySQL 之类的我们需要使用它就要获取他的 IP ，但 WSL 每次启动的时候都会有不同的 IP 地址，所以每次重启计算机都要重新获取 WSL 的 IP 是一件很麻烦的事情，当然网上的解决方案有很多，就比如有使用脚本侥幸处理的，我使用的是名为 "),a("code",[s._v("go-wsl2-host")]),s._v(" 的开源软件，GitHub 地址为 "),a("a",{attrs:{href:"https://github.com/shayne/go-wsl2-host",target:"_blank",rel:"noopener noreferrer"}},[s._v("go-wsl2-host"),a("OutboundLink")],1),s._v(" ，可自行参考安装即可。")]),s._v(" "),a("p",[a("strong",[s._v("我使用时遇到的问题")])]),s._v(" "),a("ol",[a("li",[s._v("这个软件的方案就是修改主机的 hosts 文件来达到目的，如果有遇到"),a("strong",[s._v("hosts")]),s._v("文件没有修改成功的问题，请尝试将 hosts 文件的只读属性取消勾选。")])]),s._v(" "),a("h2",{attrs:{id:"wsl-中获取宿主机-ip-及自己的-ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wsl-中获取宿主机-ip-及自己的-ip"}},[s._v("#")]),s._v(" WSL 中获取宿主机 IP 及自己的 IP")]),s._v(" "),a("p",[s._v("WSL 每次启动的时候都会有不同的 IP 地址，但他会把 IP 写在 "),a("code",[s._v("/etc/resolv.conf")]),s._v(" 中。")]),s._v(" "),a("p",[a("strong",[s._v("获取宿主机 IP")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/resolv.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nameserver "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{ print "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v(" }'")]),s._v("\n")])])]),a("p",[a("strong",[s._v("获取自己的 IP")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v(" -I "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者使用 ip 命令查看")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" a\n")])])]),a("h2",{attrs:{id:"wsl-虚拟机的导出与导入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wsl-虚拟机的导出与导入"}},[s._v("#")]),s._v(" WSL 虚拟机的导出与导入")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("wsl --export "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("分发版名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 导出文件.tar\nwsl --import "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("分发版名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("安装位置"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 导入文件.tar\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除")]),s._v("\nwsl --unregister "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("分发版名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);