(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{384:function(t,s,a){"use strict";a.r(s);var n=a(45),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"abp-的异常处理机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abp-的异常处理机制"}},[t._v("#")]),t._v(" ABP 的异常处理机制")]),t._v(" "),a("h2",{attrs:{id:"异常处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常处理"}},[t._v("#")]),t._v(" 异常处理")]),t._v(" "),a("p",[t._v("ABP 内置了处理异常的基础结构，并提供了用于处理异常的标准模型。")]),t._v(" "),a("ul",[a("li",[t._v("会自动处理所有异常，并对 API/AJAX 请求的客户端发送标准的错误格式消息。")]),t._v(" "),a("li",[t._v("自动隐藏内部基础结构错误并返回标准的错误消息。")]),t._v(" "),a("li",[t._v("提供简单的可配置的方式来处理异常消息本地化。")]),t._v(" "),a("li",[t._v("自动将标准异常映射到HTTP状态码，提供可配置的选项来映射自定义异常。")])]),t._v(" "),a("h2",{attrs:{id:"自动处理异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动处理异常"}},[t._v("#")]),t._v(" 自动处理异常")]),t._v(" "),a("p",[t._v("在满足以下任一条件时 "),a("code",[t._v("AbpExceptionFilter")]),t._v(" 就会处理异常。")]),t._v(" "),a("ul",[a("li",[t._v("当 "),a("strong",[t._v("Controller Action")]),t._v("  返回结果而不是视图时的抛出异常。")]),t._v(" "),a("li",[t._v("当该请求是一个 "),a("code",[t._v("AJAX")]),t._v(" 请求时，也就是 "),a("code",[t._v("HTTP Header")]),t._v(" 的 "),a("code",[t._v("X-Requested-With")]),t._v(" 值为 "),a("code",[t._v("XMLHttpRequest")]),t._v(" 时。")]),t._v(" "),a("li",[t._v("当客户端显式的标明接受的值为 "),a("code",[t._v("application/json")]),t._v(" 时。")])]),t._v(" "),a("h2",{attrs:{id:"错误的结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误的结构"}},[t._v("#")]),t._v(" 错误的结构")]),t._v(" "),a("p",[t._v("错误消息是 "),a("code",[t._v("RemoteServiceErrorResponse")]),t._v(" 类的实例。 最简单的错误如下所示：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"error"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"message"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"This topic is locked and can not add a new message"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("它拥有一些可选的字段，可以根据发生的异常进行填充不同的字段。")]),t._v(" "),a("h3",{attrs:{id:"带有-code-的错误信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#带有-code-的错误信息"}},[t._v("#")]),t._v(" 带有 Code 的错误信息")]),t._v(" "),a("p",[t._v("抛出的异常类实现了 "),a("code",[t._v("IHasErrorCode")]),t._v(" 接口的异常格式")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"error"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"App:010042"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"message"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"This topic is locked and can not add a new message"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"带有-details-的错误信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#带有-details-的错误信息"}},[t._v("#")]),t._v(" 带有 Details 的错误信息")]),t._v(" "),a("p",[t._v("抛出的异常类实现了 "),a("code",[t._v("IHasErrorDetails")]),t._v(" 接口的异常格式")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"error"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"App:010042"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"message"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"This topic is locked and can not add a new message"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"details"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A more detailed info about the error..."')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"实体验证错误时的错误信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实体验证错误时的错误信息"}},[t._v("#")]),t._v(" 实体验证错误时的错误信息")]),t._v(" "),a("p",[t._v("抛出的异常类实现了 "),a("code",[t._v("IHasValidationErrors")]),t._v(" 接口的异常格式")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"error"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"App:010046"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"message"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Your request is not valid, please correct and try again!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"validationErrors"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"message"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Username should be minimum length of 3."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"members"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userName"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"message"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Password is required"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"members"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"password"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("AbpValidationException")]),t._v(" 实现 "),a("code",[t._v("IHasValidationErrors")]),t._v(" 接口，当请求输入不符合时，框架会自动抛出该异常。 所以除非您具有高级定制的验证逻辑，否则通常不需要处理验证错误。")]),t._v(" "),a("h2",{attrs:{id:"日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志"}},[t._v("#")]),t._v(" 日志")]),t._v(" "),a("p",[t._v("捕获的异常将自动记录到日志。")]),t._v(" "),a("h3",{attrs:{id:"日志级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志级别"}},[t._v("#")]),t._v(" 日志级别")]),t._v(" "),a("p",[t._v("默认情况下将使用错误级别记录异常日志，当异常类实现 "),a("code",[t._v("IHasLogLevel")]),t._v(" 接口时可自定义日志记录级别。")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token type-list"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IHasLogLevel")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("LogLevel")]),t._v(" LogLevel "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LogLevel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Warning"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"额外的记录特殊情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#额外的记录特殊情况"}},[t._v("#")]),t._v(" 额外的记录特殊情况")]),t._v(" "),a("p",[t._v("当一些异常需要记录一些额外的信息时，可以让异常类实现 "),a("code",[t._v("IExceptionWithSelfLogging")]),t._v(" 接口")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token type-list"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IExceptionWithSelfLogging")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ILogger")]),t._v(" logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//...log additional info")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("blockquote",[a("p",[a("code",[t._v("ILogger.LogException")]),t._v(" 扩展方法可用于写入异常日志，可以在需要时使用此方法。")])]),t._v(" "),a("h2",{attrs:{id:"业务异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#业务异常"}},[t._v("#")]),t._v(" 业务异常")]),t._v(" "),a("p",[t._v("大多数的异常都为业务异常，使用 "),a("code",[t._v("IBusinessException")]),t._v(" 接口将异常标记为业务异常。")]),t._v(" "),a("p",[a("code",[t._v("BusinessException")]),t._v(" 类实现 "),a("code",[t._v("IBusinessException")]),t._v(" "),a("code",[t._v("IHasErrorCode")]),t._v(" "),a("code",[t._v("IHasErrorDetails")]),t._v(" "),a("code",[t._v("IHasLogLevel")]),t._v(" 接口，日志记录级别为 "),a("code",[t._v("Warning")]),t._v("。")]),t._v(" "),a("p",[t._v("通常要提供与业务相关的错误代码。")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("BusinessException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("QaErrorCodes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CanNotVoteYourOwnAnswer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("code",[t._v("QaErrorCodes.CanNotVoteYourOwnAnswer")]),t._v(" 是一个字符串类型的常量，ABP 推荐使用这样的格式："),a("code",[t._v("<命令空间>:<错误代码>")])]),t._v(" "),a("h2",{attrs:{id:"异常本地化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常本地化"}},[t._v("#")]),t._v(" 异常本地化")]),t._v(" "),a("h3",{attrs:{id:"对用户有好的异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对用户有好的异常"}},[t._v("#")]),t._v(" 对用户有好的异常")]),t._v(" "),a("p",[t._v("如果异常实现了 "),a("code",[t._v("IUserFriendlyException")]),t._v(" 接口，ABP 不会更改其 "),a("code",[t._v("Message")]),t._v(" 和 "),a("code",[t._v("Details")]),t._v(" 属性，而是将其直接发送给客户端。")]),t._v(" "),a("p",[a("code",[t._v("UserFriendlyException")]),t._v(" 是对 "),a("code",[t._v("IUserFriendlyException")]),t._v(" 接口的实现")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("UserFriendlyException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_stringLocalizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UserNameShouldBeUniqueMessage"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[t._v("这样就可以使用本地化了")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("IUserFriendlyException")]),t._v(" 接口是从  "),a("code",[t._v("IBusinessException")]),t._v(" 派生的。")]),t._v(" "),a("p",[a("code",[t._v("UserFriendlyException")]),t._v(" 类是从 "),a("code",[t._v("BusinessException")]),t._v(" 类派生的。")])]),t._v(" "),a("h3",{attrs:{id:"using-error-codes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-error-codes"}},[t._v("#")]),t._v(" Using Error Codes")]),t._v(" "),a("p",[a("code",[t._v("UserFriendlyException")]),t._v(" 很好，但是在高级用法中存在一些问题：")]),t._v(" "),a("ul",[a("li",[t._v("它要求您将"),a("code",[t._v("字符串本地化器")]),t._v("注入到所有的地方，并在引发异常时始终使用它。但是在某些地方无法使用 "),a("code",[t._v("字符串本地化器")]),t._v("，比如在 "),a("code",[t._v("static context")]),t._v(" 或实体方法中。")])]),t._v(" "),a("p",[t._v("在模块配置中定义"),a("strong",[t._v("code-namespace")]),t._v("到本地化资源的映射：")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[t._v("services"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token generic-method"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Configure")]),a("span",{pre:!0,attrs:{class:"token generic class-name"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("AbpExceptionLocalizationOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MapCodeNamespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Volo.Qa"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token type-expression class-name"}},[t._v("QaResource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("然后对 "),a("code",[t._v("Volo.Qa")]),t._v(" 命名空间中的任何异常进行本地化。 本地化资源应始终具有带有错误代码。")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"culture"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"en"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"texts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"App:010046"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"Username should be unique. '{UserName}' is already taken!\"")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("然后，引发业务异常使用错误代码，并自定义错误消息：")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("BusinessException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("QaDomainErrorCodes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CanNotVoteYourOwnAnswer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("WithData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UserName"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"john"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 两者等价")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("BusinessException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("QaDomainErrorCodes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CanNotVoteYourOwnAnswer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UserName"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"john"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"http-状态码的映射"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-状态码的映射"}},[t._v("#")]),t._v(" HTTP 状态码的映射")]),t._v(" "),a("p",[t._v("ABP 通过遵循以下规则为常见异常类型自动确定 HTTP 状态码：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("AbpAuthorizationException")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("401")]),t._v(" (未授权) 用户未登录")]),t._v(" "),a("li",[a("code",[t._v("403")]),t._v(" (禁止禁用) 用户登录的情况下")])])]),t._v(" "),a("li",[a("code",[t._v("AbpValidationException")]),t._v(" "),a("code",[t._v("400")]),t._v(" (错误请求)")]),t._v(" "),a("li",[a("code",[t._v("EntityNotFoundException")]),t._v(" "),a("code",[t._v("404")]),t._v(" (未找到)")]),t._v(" "),a("li",[a("code",[t._v("IBusinessException")]),t._v(" "),a("code",[t._v("403")]),t._v(" (禁用)")]),t._v(" "),a("li",[a("code",[t._v("NotImplementedException")]),t._v(" "),a("code",[t._v("501")]),t._v(" (未实现)")]),t._v(" "),a("li",[t._v("一些其他的错误(those are assumed as infrastructure exceptions) "),a("code",[t._v("500")]),t._v(" (服务器内部错误)")])]),t._v(" "),a("p",[a("code",[t._v("IHttpExceptionStatusCodeFinder")]),t._v(" 用于自动确定HTTP状态代码。 默认实现是 "),a("code",[t._v("DefaultHttpExceptionStatusCodeFinder")]),t._v(" 类。 可以根据需要替换或扩展它。")]),t._v(" "),a("h3",{attrs:{id:"自定义个别映射"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义个别映射"}},[t._v("#")]),t._v(" 自定义个别映射")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[t._v("services"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token generic-method"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Configure")]),a("span",{pre:!0,attrs:{class:"token generic class-name"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("AbpExceptionHttpStatusCodeOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Volo.Qa:010002"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HttpStatusCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Conflict"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"订阅异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#订阅异常"}},[t._v("#")]),t._v(" 订阅异常")]),t._v(" "),a("p",[t._v("当ABP框架处理异常时，可能会收到通知。 它会自动将所有异常记录到标准记录器中，但是您可能需要做更多的事情。")]),t._v(" "),a("p",[t._v("在这种情况下，在您的应用程序中创建一个从 "),a("code",[t._v("ExceptionSubscriber")]),t._v(" 类派生的类：")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyExceptionSubscriber")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token type-list"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExceptionSubscriber")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("HandleAsync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExceptionNotificationContext")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//TODO...")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("context")]),t._v(" 对象包含有关发生的异常的相关信息。")]),t._v(" "),a("blockquote",[a("p",[t._v("您可以有多个订阅者，每个订阅者都可以获取异常的副本。 订阅者抛出的异常将被忽略（但仍会被日志记录）。")])]),t._v(" "),a("h2",{attrs:{id:"abp-内置异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abp-内置异常"}},[t._v("#")]),t._v(" ABP 内置异常")]),t._v(" "),a("p",[t._v("框架会自动抛出的一些异常类型:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("AbpAuthorizationException")]),t._v(" is thrown if the current user has no permission to perform the requested operation. See "),a("a",{attrs:{href:"https://docs.abp.io/en/abp/latest/Authorization",target:"_blank",rel:"noopener noreferrer"}},[t._v("authorization"),a("OutboundLink")],1),t._v(" for more.")]),t._v(" "),a("li",[a("code",[t._v("AbpValidationException")]),t._v(" is thrown if the input of the current request is not valid. See "),a("a",{attrs:{href:"https://docs.abp.io/en/abp/latest/Validation",target:"_blank",rel:"noopener noreferrer"}},[t._v("validation"),a("OutboundLink")],1),t._v(" for more.")]),t._v(" "),a("li",[a("code",[t._v("EntityNotFoundException")]),t._v(" is thrown if the requested entity is not available. This is mostly thrown by "),a("a",{attrs:{href:"https://docs.abp.io/en/abp/latest/Repositories",target:"_blank",rel:"noopener noreferrer"}},[t._v("repositories"),a("OutboundLink")],1),t._v(".")])]),t._v(" "),a("h2",{attrs:{id:"将异常详细发送给客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将异常详细发送给客户端"}},[t._v("#")]),t._v(" 将异常详细发送给客户端")]),t._v(" "),a("p",[t._v("You can send exceptions to the client via the "),a("code",[t._v("SendExceptionsDetailsToClients")]),t._v(" property of the "),a("code",[t._v("AbpExceptionHandlingOptions")]),t._v(" class:")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[t._v("services"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token generic-method"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Configure")]),a("span",{pre:!0,attrs:{class:"token generic class-name"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("AbpExceptionHandlingOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SendExceptionsDetailsToClients "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("hr"),t._v(" "),a("p",[t._v("翻译了一下ABP的官方文档。"),a("a",{attrs:{href:"https://docs.abp.io/en/abp/latest/Exception-Handling#business-exceptions",target:"_blank",rel:"noopener noreferrer"}},[t._v("Exception Handling | ABP Documentation"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);