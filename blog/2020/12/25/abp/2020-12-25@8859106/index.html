<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ABP 的异常处理机制"><meta name="keywords" content="abp"><meta name="author" content="cglang"><meta name="copyright" content="cglang"><title>ABP 的异常处理机制 | 飞翔的鱼</title><link rel="shortcut icon" href="/blog/img/melody-favicon.ico"><link rel="stylesheet" href="/blog/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">异常处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8"><span class="toc-number">2.</span> <span class="toc-text">自动处理异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">错误的结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89-Code-%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">3.1.</span> <span class="toc-text">带有 Code 的错误信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89-Details-%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">3.2.</span> <span class="toc-text">带有 Details 的错误信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E9%AA%8C%E8%AF%81%E9%94%99%E8%AF%AF%E6%97%B6%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">3.3.</span> <span class="toc-text">实体验证错误时的错误信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-number">4.</span> <span class="toc-text">日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB"><span class="toc-number">4.1.</span> <span class="toc-text">日志级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%9D%E5%A4%96%E7%9A%84%E8%AE%B0%E5%BD%95%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5"><span class="toc-number">4.2.</span> <span class="toc-text">额外的记录特殊情况</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%BC%82%E5%B8%B8"><span class="toc-number">5.</span> <span class="toc-text">业务异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E6%9C%AC%E5%9C%B0%E5%8C%96"><span class="toc-number">6.</span> <span class="toc-text">异常本地化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E7%94%A8%E6%88%B7%E6%9C%89%E5%A5%BD%E7%9A%84%E5%BC%82%E5%B8%B8"><span class="toc-number">6.1.</span> <span class="toc-text">对用户有好的异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-Error-Codes"><span class="toc-number">6.2.</span> <span class="toc-text">Using Error Codes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP-%E7%8A%B6%E6%80%81%E7%A0%81%E7%9A%84%E6%98%A0%E5%B0%84"><span class="toc-number">7.</span> <span class="toc-text">HTTP 状态码的映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AA%E5%88%AB%E6%98%A0%E5%B0%84"><span class="toc-number">7.1.</span> <span class="toc-text">自定义个别映射</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E5%BC%82%E5%B8%B8"><span class="toc-number">8.</span> <span class="toc-text">订阅异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ABP-%E5%86%85%E7%BD%AE%E5%BC%82%E5%B8%B8"><span class="toc-number">9.</span> <span class="toc-text">ABP 内置异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E5%BC%82%E5%B8%B8%E8%AF%A6%E7%BB%86%E5%8F%91%E9%80%81%E7%BB%99%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">10.</span> <span class="toc-text">将异常详细发送给客户端</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://cglang.com/blog/img/avatar.jpg"></div><div class="author-info__name text-center">cglang</div><div class="author-info__description text-center">我自是光亮</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/blog/archives"><span class="pull-left">文章</span><span class="pull-right">27</span></a><a class="author-info-articles__tags article-meta" href="/blog/tags"><span class="pull-left">标签</span><span class="pull-right">11</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://passion-ke.github.io/">畅谈小屋</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://dylanjor.github.io/">DyLanJor</a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/blog/">飞翔的鱼</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/blog/">主页</a><a class="site-page" href="/blog/tags">标签</a><a class="site-page" href="/blog/about">关于</a></span><span class="pull-right"></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">ABP 的异常处理机制</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-12-25</time></div><div class="article-container" id="post-content"><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>ABP 内置了处理异常的基础结构，并提供了用于处理异常的标准模型。</p>
<ul>
<li>会自动处理所有异常，并对 API/AJAX 请求的客户端发送标准的错误格式消息。</li>
<li>自动隐藏内部基础结构错误并返回标准的错误消息。</li>
<li>提供简单的可配置的方式来处理异常消息本地化。</li>
<li>自动将标准异常映射到HTTP状态码，提供可配置的选项来映射自定义异常。</li>
</ul>
<h2 id="自动处理异常"><a href="#自动处理异常" class="headerlink" title="自动处理异常"></a>自动处理异常</h2><p>在满足以下任一条件时 <code>AbpExceptionFilter</code> 就会处理异常。</p>
<ul>
<li>当 <strong>Controller Action</strong>  返回结果而不是视图时的抛出异常。</li>
<li>当该请求是一个 <code>AJAX</code> 请求时，也就是 <code>HTTP Header</code> 的 <code>X-Requested-With</code> 值为 <code>XMLHttpRequest</code> 时。</li>
<li>当客户端显式的标明接受的值为 <code>application/json</code> 时。</li>
</ul>
<h2 id="错误的结构"><a href="#错误的结构" class="headerlink" title="错误的结构"></a>错误的结构</h2><p>错误消息是 <code>RemoteServiceErrorResponse</code> 类的实例。 最简单的错误如下所示：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;error&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;This topic is locked and can not add a new message&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它拥有一些可选的字段，可以根据发生的异常进行填充不同的字段。</p>
<h3 id="带有-Code-的错误信息"><a href="#带有-Code-的错误信息" class="headerlink" title="带有 Code 的错误信息"></a>带有 Code 的错误信息</h3><p> 抛出的异常类实现了 <code>IHasErrorCode</code> 接口的异常格式</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;error&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;App:010042&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;This topic is locked and can not add a new message&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="带有-Details-的错误信息"><a href="#带有-Details-的错误信息" class="headerlink" title="带有 Details 的错误信息"></a>带有 Details 的错误信息</h3><p> 抛出的异常类实现了 <code>IHasErrorDetails</code> 接口的异常格式</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;error&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;App:010042&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;This topic is locked and can not add a new message&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;details&quot;</span>: <span class="string">&quot;A more detailed info about the error...&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="实体验证错误时的错误信息"><a href="#实体验证错误时的错误信息" class="headerlink" title="实体验证错误时的错误信息"></a>实体验证错误时的错误信息</h3><p> 抛出的异常类实现了 <code>IHasValidationErrors</code> 接口的异常格式</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;error&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;App:010046&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Your request is not valid, please correct and try again!&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;validationErrors&quot;</span>: [&#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Username should be minimum length of 3.&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;members&quot;</span>: [<span class="string">&quot;userName&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Password is required&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;members&quot;</span>: [<span class="string">&quot;password&quot;</span>]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>AbpValidationException</code> 实现 <code>IHasValidationErrors</code> 接口，当请求输入不符合时，框架会自动抛出该异常。 所以除非您具有高级定制的验证逻辑，否则通常不需要处理验证错误。</p>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><p>捕获的异常将自动记录到日志。</p>
<h3 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h3><p>默认情况下将使用错误级别记录异常日志，当异常类实现 <code>IHasLogLevel</code> 接口时可自定义日志记录级别。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyException</span> : <span class="title">Exception</span>, <span class="title">IHasLogLevel</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> LogLevel LogLevel &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = LogLevel.Warning;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="额外的记录特殊情况"><a href="#额外的记录特殊情况" class="headerlink" title="额外的记录特殊情况"></a>额外的记录特殊情况</h3><p>当一些异常需要记录一些额外的信息时，可以让异常类实现 <code>IExceptionWithSelfLogging</code> 接口</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyException</span> : <span class="title">Exception</span>, <span class="title">IExceptionWithSelfLogging</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Log</span>(<span class="params">ILogger logger</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//...log additional info</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>ILogger.LogException</code> 扩展方法可用于写入异常日志，可以在需要时使用此方法。</p>
</blockquote>
<h2 id="业务异常"><a href="#业务异常" class="headerlink" title="业务异常"></a>业务异常</h2><p>大多数的异常都为业务异常，使用 <code>IBusinessException</code> 接口将异常标记为业务异常。</p>
<p><code>BusinessException</code> 类实现 <code>IBusinessException</code> <code>IHasErrorCode</code> <code>IHasErrorDetails</code> <code>IHasLogLevel</code> 接口，日志记录级别为 <code>Warning</code>。</p>
<p>通常要提供与业务相关的错误代码。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(QaErrorCodes.CanNotVoteYourOwnAnswer);</span><br></pre></td></tr></table></figure>

<p><code>QaErrorCodes.CanNotVoteYourOwnAnswer</code> 是一个字符串类型的常量，ABP 推荐使用这样的格式：<code>&lt;命令空间&gt;:&lt;错误代码&gt;</code></p>
<h2 id="异常本地化"><a href="#异常本地化" class="headerlink" title="异常本地化"></a>异常本地化</h2><h3 id="对用户有好的异常"><a href="#对用户有好的异常" class="headerlink" title="对用户有好的异常"></a>对用户有好的异常</h3><p>如果异常实现了 <code>IUserFriendlyException</code> 接口，ABP 不会更改其 <code>Message</code> 和 <code>Details</code> 属性，而是将其直接发送给客户端。</p>
<p><code>UserFriendlyException</code> 是对 <code>IUserFriendlyException</code> 接口的实现</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> UserFriendlyException(_stringLocalizer[<span class="string">&quot;UserNameShouldBeUniqueMessage&quot;</span>]);</span><br></pre></td></tr></table></figure>

<ul>
<li>这样就可以使用本地化了</li>
</ul>
<blockquote>
<p><code>IUserFriendlyException</code> 接口是从  <code>IBusinessException</code> 派生的。</p>
<p><code>UserFriendlyException</code> 类是从 <code>BusinessException</code> 类派生的。</p>
</blockquote>
<h3 id="Using-Error-Codes"><a href="#Using-Error-Codes" class="headerlink" title="Using Error Codes"></a>Using Error Codes</h3><p><code>UserFriendlyException</code> 很好，但是在高级用法中存在一些问题：</p>
<ul>
<li>它要求您将<code>字符串本地化器</code>注入到所有的地方，并在引发异常时始终使用它。但是在某些地方无法使用 <code>字符串本地化器</code>，比如在 <code>static context</code> 或实体方法中。</li>
</ul>
<p>在模块配置中定义<strong>code-namespace</strong>到本地化资源的映射：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">services.Configure&lt;AbpExceptionLocalizationOptions&gt;(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.MapCodeNamespace(<span class="string">&quot;Volo.Qa&quot;</span>, <span class="keyword">typeof</span>(QaResource));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>然后对 <code>Volo.Qa</code> 命名空间中的任何异常进行本地化。 本地化资源应始终具有带有错误代码。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;culture&quot;</span>: <span class="string">&quot;en&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;texts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;App:010046&quot;</span>: <span class="string">&quot;Username should be unique. &#x27;&#123;UserName&#125;&#x27; is already taken!&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，引发业务异常使用错误代码，并自定义错误消息：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(QaDomainErrorCodes.CanNotVoteYourOwnAnswer)</span><br><span class="line">    .WithData(<span class="string">&quot;UserName&quot;</span>, <span class="string">&quot;john&quot;</span>);</span><br><span class="line"><span class="comment">// 两者等价</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(QaDomainErrorCodes.CanNotVoteYourOwnAnswer)</span><br><span class="line">&#123;</span><br><span class="line">    Data =</span><br><span class="line">    &#123;</span><br><span class="line">        &#123;<span class="string">&quot;UserName&quot;</span>, <span class="string">&quot;john&quot;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="HTTP-状态码的映射"><a href="#HTTP-状态码的映射" class="headerlink" title="HTTP 状态码的映射"></a>HTTP 状态码的映射</h2><p>ABP 通过遵循以下规则为常见异常类型自动确定 HTTP 状态码：</p>
<ul>
<li><code>AbpAuthorizationException</code> <ul>
<li><code>401</code> (未授权) 用户未登录</li>
<li><code>403</code> (禁止禁用) 用户登录的情况下</li>
</ul>
</li>
<li><code>AbpValidationException</code> <code>400</code> (错误请求)</li>
<li><code>EntityNotFoundException</code> <code>404</code> (未找到)</li>
<li><code>IBusinessException</code> <code>403</code> (禁用)</li>
<li><code>NotImplementedException</code> <code>501</code> (未实现)</li>
<li>一些其他的错误(those are assumed as infrastructure exceptions) <code>500</code> (服务器内部错误)</li>
</ul>
<p><code>IHttpExceptionStatusCodeFinder</code> 用于自动确定HTTP状态代码。 默认实现是 <code>DefaultHttpExceptionStatusCodeFinder</code> 类。 可以根据需要替换或扩展它。</p>
<h3 id="自定义个别映射"><a href="#自定义个别映射" class="headerlink" title="自定义个别映射"></a>自定义个别映射</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">services.Configure&lt;AbpExceptionHttpStatusCodeOptions&gt;(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.Map(<span class="string">&quot;Volo.Qa:010002&quot;</span>, HttpStatusCode.Conflict);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="订阅异常"><a href="#订阅异常" class="headerlink" title="订阅异常"></a>订阅异常</h2><p>当ABP框架处理异常时，可能会收到通知。 它会自动将所有异常记录到标准记录器中，但是您可能需要做更多的事情。</p>
<p>在这种情况下，在您的应用程序中创建一个从 <code>ExceptionSubscriber</code> 类派生的类：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyExceptionSubscriber</span> : <span class="title">ExceptionSubscriber</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> <span class="keyword">override</span> Task <span class="title">HandleAsync</span>(<span class="params">ExceptionNotificationContext context</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//TODO...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>context</code> 对象包含有关发生的异常的相关信息。</p>
<blockquote>
<p>您可以有多个订阅者，每个订阅者都可以获取异常的副本。 订阅者抛出的异常将被忽略（但仍会被日志记录）。</p>
</blockquote>
<h2 id="ABP-内置异常"><a href="#ABP-内置异常" class="headerlink" title="ABP 内置异常"></a>ABP 内置异常</h2><p>框架会自动抛出的一些异常类型:</p>
<ul>
<li><code>AbpAuthorizationException</code> is thrown if the current user has no permission to perform the requested operation. See <a target="_blank" rel="noopener" href="https://docs.abp.io/en/abp/latest/Authorization">authorization</a> for more.</li>
<li><code>AbpValidationException</code> is thrown if the input of the current request is not valid. See <a target="_blank" rel="noopener" href="https://docs.abp.io/en/abp/latest/Validation">validation</a> for more.</li>
<li><code>EntityNotFoundException</code> is thrown if the requested entity is not available. This is mostly thrown by <a target="_blank" rel="noopener" href="https://docs.abp.io/en/abp/latest/Repositories">repositories</a>.</li>
</ul>
<h2 id="将异常详细发送给客户端"><a href="#将异常详细发送给客户端" class="headerlink" title="将异常详细发送给客户端"></a>将异常详细发送给客户端</h2><p>You can send exceptions to the client via the <code>SendExceptionsDetailsToClients</code> property of the <code>AbpExceptionHandlingOptions</code> class:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">services.Configure&lt;AbpExceptionHandlingOptions&gt;(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.SendExceptionsDetailsToClients = <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<hr>
<p>翻译了一下ABP的官方文档。<a target="_blank" rel="noopener" href="https://docs.abp.io/en/abp/latest/Exception-Handling#business-exceptions">Exception Handling | ABP Documentation</a></p>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/blog/tags/abp/">abp</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/blog/2020/12/30/abp/2020-12-30@9310691/"><i class="fa fa-chevron-left">  </i><span>ABP 中获取当前用户相关的信息</span></a></div><div class="next-post pull-right"><a href="/blog/2020/12/24/linux/2020-12-24@8776803/"><span>我使用的 WSL 2 及相关设置</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(undefined)"><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2021 By cglang</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/blog/js/utils.js?version=1.9.0"></script><script src="/blog/js/fancybox.js?version=1.9.0"></script><script src="/blog/js/sidebar.js?version=1.9.0"></script><script src="/blog/js/copy.js?version=1.9.0"></script><script src="/blog/js/fireworks.js?version=1.9.0"></script><script src="/blog/js/transition.js?version=1.9.0"></script><script src="/blog/js/scroll.js?version=1.9.0"></script><script src="/blog/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>